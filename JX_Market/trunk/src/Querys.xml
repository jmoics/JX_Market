<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE sqlMap      
PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"      
"http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap>
    <typeAlias alias="DTO_Cliente" type="pe.com.jx_market.domain.DTO_Cliente" />
    <typeAlias alias="DTO_Empleado" type="pe.com.jx_market.domain.DTO_Empleado" />
    <typeAlias alias="DTO_Usuario" type="pe.com.jx_market.domain.DTO_Usuario" />
    <typeAlias alias="DTO_Empresa" type="pe.com.jx_market.domain.DTO_Empresa" />
    <typeAlias alias="DTO_Articulo" type="pe.com.jx_market.domain.DTO_Articulo" />
    <typeAlias alias="DTO_Categoria" type="pe.com.jx_market.domain.DTO_Categoria" />

    <!-- MANTENIMIENTO DE CLIENTES -->

    <select id="getClientePorCodigo" resultClass="DTO_Cliente">
        SELECT
            cl.cliente_n_codigo as codigo,
            cl.usuario_n_codigo as usuario,
            cl.empresa_n_codigo as empresa,
            cl.cliente_v_nombre as nombre,
            cl.cliente_d_fechanac as fecNac,
            cl.cliente_v_apellido as apellido,
            cl.cliente_n_dni as dni,
            cl.cliente_v_direccion as direccion,
            cl.cliente_v_telefono as telefono,
            cl.cliente_v_celular as celular,
            cl.cliente_v_email as email,
            cl.cliente_v_ciudad as ciudad,
            cl.cliente_v_region as region,
            cl.cliente_v_codpostal as codPostal,
            cl.cliente_n_activo as estado
        FROM
            T_NEG_CLIENTE cl,
            T_SEG_USUARIO us,
            T_EMP_EMPRESA em
        WHERE
            us.usuario_n_codigo = cl.usuario_n_codigo
        AND
            us.empresa_n_codigo = em.empresa_n_codigo
        AND
            us.cliente_n_codigo = #cliente_n_codigo#
        AND
            us.empresa_n_codigo = #empresa_n_codigo#
    </select>

    <select id="getClientes" resultClass="DTO_Cliente">
        SELECT
            cl.cliente_n_codigo as codigo,
            cl.usuario_n_codigo as usuario,
            cl.empresa_n_codigo as empresa,
            cl.cliente_v_nombre as nombre,
            cl.cliente_d_fechanac as fecNac,
            cl.cliente_v_apellido as apellido,
            cl.cliente_n_dni as dni,
            cl.cliente_v_direccion as direccion,
            cl.cliente_v_telefono as telefono,
            cl.cliente_v_celular as celular,
            cl.cliente_v_email as email,
            cl.cliente_v_ciudad as ciudad,
            cl.cliente_v_region as region,
            cl.cliente_v_codpostal as codPostal,
            cl.cliente_n_activo as estado
        FROM
            T_NEG_CLIENTE cl
        WHERE
            cl.empresa_n_codigo = #empresa_n_codigo#
        ORDER BY
            cl.cliente_n_codigo
    </select>

    <insert id="insertCliente">
        INSERT INTO
        T_NEG_CLIENTE
            (cliente_n_codigo,
            usuario_n_codigo,
            empresa_n_codigo,
            cliente_v_nombre,
            cliente_d_fechanac,
            cliente_v_apellido,
            cliente_n_dni,
            cliente_v_direccion,
            cliente_v_telefono,
            cliente_v_celular,
            cliente_v_email,
            cliente_v_ciudad,
            cliente_v_region,
            cliente_v_codpostal,
            cliente_n_activo)
        VALUES
            (#cliente_n_codigo#,
            #usuario_n_codigo#,
            #empresa_n_codigo#,
            #cliente_v_nombre#,
            #cliente_d_fechanac#,
            #cliente_v_apellido#,
            #cliente_n_dni#,
            #cliente_v_direccion#,
            #cliente_v_telefono#,
            #cliente_v_celular#,
            #cliente_v_email#,
            #cliente_v_ciudad#,
            #cliente_v_region#,
            #cliente_v_codpostal#,
            #cliente_n_activo#)
    </insert>


    <!-- MANTENIMIENTO DE EMPLEADOS -->

    <select id="getEmpleados" parameterClass="DTO_Empleado" resultClass="DTO_Empleado">
        SELECT
            emp.empleado_n_codigo as codigo,
            emp.usuario_n_codigo as usuario,
            emp.empresa_n_codigo as empresa,
            emp.empleado_v_nombre as nombre,
            emp.empleado_d_fechanac as fecNac,
            emp.empleado_v_apellido as apellido,
            emp.empleado_n_dni as dni,
            emp.empleado_v_direccion as direccion,
            emp.empleado_v_telefono as telefono,
            emp.empleado_v_celular as celular,
            emp.empleado_v_email as email,
            emp.empleado_v_ciudad as ciudad,
            emp.empleado_v_region as region,
            emp.empleado_n_activo as estado
        FROM
            T_EMP_EMPLEADO emp
        WHERE
            us.empresa_n_codigo = #empresa#
        <isNotNull prepend="AND" property="usuario">
            us.usuario_n_codigo = #usuario#
        </isNotNull>
        <isNotNull prepend="AND" property="empleado">
            us.empleado_n_codigo = #empleado#
        </isNotNull>
    </select>

    <insert id="insertEmpleado" parameterClass="DTO_Empleado">
        INSERT INTO
        T_EMP_EMPLEADO
            (usuario_n_codigo, empresa_n_codigo,
            empleado_v_nombre, empleado_d_fechanac, empleado_v_apellido,
            empleado_n_dni, empleado_v_direccion, empleado_v_telefono,
            empleado_v_celular, empleado_v_email, empleado_v_ciudad,
            empleado_v_region, empleado_n_activo)
        VALUES
            (#usuario#, #empresa#,
            #nombre#, #fechanac#, #apellido#,
            #dni#, #direccion#, #telefono#,
            #celular#, #email#, #ciudad#,
            #region#, #activo#)
    </insert>
    
    <update id="updateEmpleado" parameterClass="DTO_Empleado">
        UPDATE T_EMP_EMPLEADO
        SET
            usuario_n_codigo = #usuario#,
            empresa_n_codigo = #empresa#,
            empleado_v_nombre = #nombre#,
            empleado_d_fechanac = #fecNac#,
            empleado_v_apellido = #apellido#,
            empleado_n_dni = #dni#,
            empleado_v_direccion = #direccion#,
            empleado_v_telefono = #telefono#,
            empleado_v_celular = #celular#,
            empleado_v_email = #email#,
            empleado_v_ciudad = #ciudad#,
            empleado_v_region = #region#,
            empleado_n_activo = #estado#
        WHERE
            empleado_n_codigo = #codigo#
        AND
            empresa_n_codigo = #empresa#
    </update>
    
    <delete id="deleteEmpleado" parameterClass="DTO_Empleado">
      DELETE FROM
         T_EMP_EMPLEADO
      WHERE
         empresa_n_codigo = #empresa#
      AND
         empleado_n_codigo = #codigo#
    </delete>

    <!-- MANTENIMIENTO DE USUARIOS -->

    <select id="getUsuarioPorUsername" resultClass="DTO_Usuario">
        SELECT
            us.usuario_v_username as username,
            us.usuario_v_contrasena as contrasena,
            us.empresa_n_codigo as empresa
        FROM
            T_SEG_USUARIO us
        WHERE
            us.usuario_v_username = #usuario_v_username#
        AND
            us.empresa_n_codigo = #empresa_n_codigo#
    </select>

    <select id="getUsuarios" resultClass="DTO_Usuario">
        SELECT
            us.usuario_n_codigo as codigo,
            us.usuario_v_username as username,
            us.usuario_v_contrasena as contrasena,
            us.empresa_n_codigo as empresa
        FROM
            T_SEG_USUARIO us
        WHERE
            us.empresa_n_codigo = #empresa_n_codigo#
        ORDER BY
            us.usuario_n_codigo
    </select>

    <insert id="insertUsuario" parameterClass="DTO_Usuario">
        INSERT INTO T_SEG_USUARIO
            (usuario_v_username,usuario_v_contrasena,empresa_n_codigo)
        VALUES
            (#username#, #contrasena#, #empresa#)
    </insert>

    <update id="chgPass">
        UPDATE T_SEG_USUARIO
        SET
            usuario_v_contrasena = #usuario_v_contrasena#
        WHERE
            usuario_v_username = #usuario_v_username#
        AND
            empresa_n_codigo = #empresa_n_codigo#
    </update>

    <!-- MANTENIMIENTO DE EMPRESAS -->

    <select id="getEmpresaPorCodigo" resultClass="DTO_Empresa">
        SELECT
            emp.empresa_n_codigo as codigo,
            emp.empresa_v_razonsocial as razonsocial,
            emp.empresa_n_activo as estado,
            emp.empresa_v_ruc as ruc,
            emp.empresa_v_dominio as dominio
        FROM
            T_EMP_EMPRESA emp
        WHERE
            emp.empresa_n_codigo = #empresa_n_codigo#
    </select>

    <select id="getEmpresas" resultClass="DTO_Empresa">
        SELECT
            emp.empresa_n_codigo as codigo,
            emp.empresa_v_razonsocial as razonsocial,
            emp.empresa_n_activo as estado,
            emp.empresa_v_ruc as ruc,
            emp.empresa_v_dominio as dominio
        FROM
            T_EMP_EMPRESA emp
        WHERE
            emp.empresa_n_activo = 1
            <isNotNull prepend="AND" property="empresa_v_razonsocial">
               emp.empresa_v_razonsocial LIKE #empresa_v_razonsocial#
            </isNotNull>
            <isNotNull prepend="OR" property="empresa_v_ruc">
               emp.empresa_v_ruc LIKE #empresa_v_ruc#
            </isNotNull>
    </select>

    <insert id="insertEmpresa" parameterClass="DTO_Empresa">
        INSERT INTO T_EMP_EMPRESA
            (empresa_v_razonsocial,empresa_n_activo,empresa_v_ruc,empresa_v_dominio)
        VALUES
            (#razonsocial#,#estado#,#ruc#,#dominio#)
    </insert>
    
    <update id="updateEmpresa">
        UPDATE T_EMP_EMPRESA
        SET
            empresa_v_razonsocial = #empresa_v_razonsocial#,
            empresa_n_activo = #empresa_n_activo#,
            empresa_v_ruc = #empresa_v_ruc#,
            empresa_v_dominio = #empresa_v_dominio#
        WHERE
            empresa_n_codigo = #empresa_n_codigo#
    </update>

   <delete id="deleteEmpresa">
      DELETE FROM
         T_EMP_EMPRESA
      WHERE
         empresa_n_codigo = #value#
	</delete>
   
   
    <!-- MANTENIMIENTO DE PRODUCTOS -->

    <select id="getArticulos" resultClass="DTO_Articulo" parameterClass="DTO_Articulo">
        SELECT
            art.articulo_n_codigo as codigo,
            art.empresa_n_codigo as empresa,
            art.categoria_n_codigo as categoria,
            art.articulo_v_nombre as nombre,
            art.articulo_v_marca as marca,
            art.articulo_v_descripcion as descripcion,
            art.articulo_n_precio as precio,
            art.articulo_n_stock as stock,
            art.articulo_n_activo as activo,
            art.articulo_v_imagen as nomimg
        FROM
            T_NEG_ARTICULO art
        WHERE
            art.empresa_n_codigo = #empresa#
            <isNotNull prepend="AND" property="categoria">
               art.categoria_n_codigo = #categoria#
            </isNotNull>
            <isNotNull prepend="AND" property="nombre">
               art.articulo_v_nombre LIKE #nombre#
            </isNotNull>
            <isNotNull prepend="AND" property="marca">
               art.articulo_v_marca LIKE #marca#
            </isNotNull>
            <isNotNull prepend="AND" property="activo">
               art.articulo_n_activo = #activo#
            </isNotNull>
    </select>

    <select id="getArticuloXCodigo" resultClass="DTO_Articulo" parameterClass="DTO_Articulo">
        SELECT
            art.articulo_n_codigo as codigo,
            art.empresa_n_codigo as empresa,
            art.categoria_n_codigo as categoria,
            art.articulo_v_nombre as nombre,
            art.articulo_v_marca as marca,
            art.articulo_v_descripcion as descripcion,
            art.articulo_n_precio as precio,
            art.articulo_n_stock as stock,
            art.articulo_n_activo as activo,
            art.articulo_v_imagen as nomimg
        FROM
            T_NEG_ARTICULO art
        WHERE
            art.empresa_n_codigo = #empresa#
        AND
            art.articulo_n_codigo = #codigo#
    </select>

    <insert id="insertArticulo" parameterClass="DTO_Articulo">
        INSERT INTO T_NEG_ARTICULO
            (empresa_n_codigo,categoria_n_codigo,articulo_v_nombre,
            articulo_v_marca,articulo_v_descripcion,articulo_n_precio,
            articulo_n_stock,articulo_n_activo,articulo_v_imagen)
        VALUES
            (#empresa#,#categoria#,#nombre#,
            #marca#,#descripcion#,#precio#,
            #stock#,#activo#,#nomimg#)
    </insert>
    
    <update id="updateStock" parameterClass="DTO_Articulo">
        UPDATE T_NEG_ARTICULO
        SET
            articulo_n_stock = #stock#
        WHERE
            empresa_n_codigo = #empresa#
        AND
            articulo_n_codigo = #codigo#
    </update>
    
    <update id="updateArticulo" parameterClass="DTO_Articulo">
        UPDATE T_NEG_ARTICULO
        SET
            categoria_n_codigo = #categoria#,
            articulo_v_nombre = #nombre#,
            articulo_v_marca = #marca#,
            articulo_v_descripcion = #descripcion#,
            articulo_n_precio = #precio#,
            articulo_n_activo = #activo#,
            articulo_v_imagen = #nomimg#
        WHERE
            articulo_n_codigo = #codigo#
        AND
            empresa_n_codigo = #empresa#
    </update>

   <delete id="deleteArticulo">
      DELETE FROM
         T_NEG_ARTICULO
      WHERE
         articulo_n_codigo = #value#
   </delete>
   
       <!-- MANTENIMIENTO DE CATEGORIAS -->

    <select id="getCategorias" resultClass="DTO_Categoria" parameterClass="DTO_Categoria">
        SELECT
            cat.categoria_n_codigo as codigo,
            cat.empresa_n_codigo as empresa,
            cat.categoria_v_nombre as nombre
        FROM
            T_NEG_CATEGORIA cat
        WHERE
            cat.empresa_n_codigo = #empresa#
        OR
            cat.empresa_n_codigo = 1
    </select>

    <select id="getCategoriaXCodigo" resultClass="DTO_Categoria" parameterClass="DTO_Categoria">
        SELECT
            cat.categoria_n_codigo as codigo,
            cat.empresa_n_codigo as empresa,
            cat.categoria_v_nombre as nombre
        FROM
            T_NEG_CATEGORIA cat
        WHERE
            cat.categoria_n_codigo = #codigo#
    </select>

    <insert id="insertCategoria" parameterClass="DTO_Categoria">
        INSERT INTO T_NEG_CATEGORIA
            (empresa_n_codigo,categoria_v_nombre)
        VALUES
            (#empresa#,#nombre#)
    </insert>
    
    <update id="updateCategoria" parameterClass="DTO_Categoria">
        UPDATE T_NEG_CATEGORIA
        SET
            categoria_v_nombre = #nombre#,
        WHERE
            categoria_n_codigo = #codigo#
        AND
            empresa_n_codigo = #empresa#
    </update>

   <delete id="deleteCategoria" parameterClass="DTO_Categoria">
      DELETE FROM
         T_NEG_CATEGORIA
      WHERE
         categoria_n_codigo = #codigo#
   </delete>
</sqlMap>
