<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE sqlMap      
PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"      
"http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap>
    <typeAlias alias="DTO_Cliente" type="pe.com.jx_market.domain.DTO_Cliente" />

    <typeAlias alias="DTO_Empleado" type="pe.com.jx_market.domain.DTO_Empleado" />

    <typeAlias alias="DTO_Usuario" type="pe.com.jx_market.domain.DTO_Usuario" />
    
    <typeAlias alias="DTO_Empresa" type="pe.com.jx_market.domain.DTO_Empresa" />

    <!-- MANTENIMIENTO DE CLIENTES -->

    <select id="getClientePorCodigo" resultClass="DTO_Cliente">
        SELECT
            cl.cliente_n_codigo as codigo,
            cl.usuario_n_codigo as usuario,
            cl.empresa_n_codigo as empresa,
            cl.cliente_v_nombre as nombre,
            cl.cliente_d_fechanac as fecNac,
            cl.cliente_v_apellido as apellido,
            cl.cliente_n_dni as dni,
            cl.cliente_v_direccion as direccion,
            cl.cliente_v_telefono as telefono,
            cl.cliente_v_celular as celular,
            cl.cliente_v_email as email,
            cl.cliente_v_ciudad as ciudad,
            cl.cliente_v_region as region,
            cl.cliente_v_codpostal as codPostal,
            cl.cliente_n_activo as estado
        FROM
            T_NEG_CLIENTE cl,
            T_SEG_USUARIO us,
            T_EMP_EMPRESA em
        WHERE
            us.usuario_n_codigo = cl.usuario_n_codigo
        AND
            us.empresa_n_codigo = em.empresa_n_codigo
        AND
            us.cliente_n_codigo = #cliente_n_codigo#
        AND
            us.empresa_n_codigo = #empresa_n_codigo#
    </select>

    <select id="getClientes" resultClass="DTO_Cliente">
        SELECT
            cl.cliente_n_codigo as codigo,
            cl.usuario_n_codigo as usuario,
            cl.empresa_n_codigo as empresa,
            cl.cliente_v_nombre as nombre,
            cl.cliente_d_fechanac as fecNac,
            cl.cliente_v_apellido as apellido,
            cl.cliente_n_dni as dni,
            cl.cliente_v_direccion as direccion,
            cl.cliente_v_telefono as telefono,
            cl.cliente_v_celular as celular,
            cl.cliente_v_email as email,
            cl.cliente_v_ciudad as ciudad,
            cl.cliente_v_region as region,
            cl.cliente_v_codpostal as codPostal,
            cl.cliente_n_activo as estado
        FROM
            T_NEG_CLIENTE cl
        WHERE
            cl.empresa_n_codigo = #empresa_n_codigo#
        ORDER BY
            cl.cliente_n_codigo
    </select>

    <insert id="insertCliente">
        INSERT INTO
        T_NEG_CLIENTE
            (cliente_n_codigo,
            usuario_n_codigo,
            empresa_n_codigo,
            cliente_v_nombre,
            cliente_d_fechanac,
            cliente_v_apellido,
            cliente_n_dni,
            cliente_v_direccion,
            cliente_v_telefono,
            cliente_v_celular,
            cliente_v_email,
            cliente_v_ciudad,
            cliente_v_region,
            cliente_v_codpostal,
            cliente_n_activo)
        VALUES
            (#cliente_n_codigo#,
            #usuario_n_codigo#,
            #empresa_n_codigo#,
            #cliente_v_nombre#,
            #cliente_d_fechanac#,
            #cliente_v_apellido#,
            #cliente_n_dni#,
            #cliente_v_direccion#,
            #cliente_v_telefono#,
            #cliente_v_celular#,
            #cliente_v_email#,
            #cliente_v_ciudad#,
            #cliente_v_region#,
            #cliente_v_codpostal#,
            #cliente_n_activo#)
    </insert>


    <!-- MANTENIMIENTO DE EMPLEADOS -->

    <select id="getEmpleadoPorCodigo" resultClass="DTO_Cliente">
        SELECT
            emp.empleado_n_codigo as codigo,
            emp.usuario_n_codigo as usuario,
            emp.empresa_n_codigo as empresa,
            emp.empleado_v_nombre as nombre,
            emp.empleado_d_fechanac as fecNac,
            emp.empleado_v_apellido as apellido,
            emp.empleado_n_dni as dni,
            emp.empleado_v_direccion as direccion,
            emp.empleado_v_telefono as telefono,
            emp.empleado_v_celular as celular,
            emp.empleado_v_email as email,
            emp.empleado_v_ciudad as ciudad,
            emp.empleado_v_region as region,
            emp.empleado_v_codpostal as codPostal,
            emp.empleado_n_activo as estado
        FROM
            T_EMP_EMPLEADO emp,
            T_SEG_USUARIO us,
            T_EMP_EMPRESA em
        WHERE
            us.usuario_n_codigo = cl.usuario_n_codigo
        AND
            us.empresa_n_codigo = em.empresa_n_codigo
        AND
            us.empleado_n_codigo = #empleado_n_codigo#
        AND
            us.empresa_n_codigo = #empresa_n_codigo#
    </select>

    <select id="getEmpleados" resultClass="DTO_Empleado">
        SELECT
            emp.empleado_n_codigo as codigo,
            emp.usuario_n_codigo as usuario,
            emp.empresa_n_codigo as empresa,
            emp.empleado_v_nombre as nombre,
            emp.empleado_d_fechanac as fecNac,
            emp.empleado_v_apellido as apellido,
            emp.empleado_n_dni as dni,
            emp.empleado_v_direccion as direccion,
            emp.empleado_v_telefono as telefono,
            emp.empleado_v_celular as celular,
            emp.empleado_v_email as email,
            emp.empleado_v_ciudad as ciudad,
            emp.empleado_v_region as region,
            emp.empleado_v_codpostal as codPostal,
            emp.empleado_n_activo as estado
        FROM
            T_EMP_EMPLEADO emp
        WHERE
            emp.empresa_n_codigo = #empresa_n_codigo#
        ORDER BY
            emp.empleado_n_codigo
    </select>

    <insert id="insertEmpleado">
        INSERT INTO
        T_EMP_EMPLEADO
            (empleado_n_codigo,
            usuario_n_codigo,
            empresa_n_codigo,
            empleado_v_nombre,
            empleado_d_fechanac,
            empleado_v_apellido,
            empleado_n_dni,
            empleado_v_direccion,
            empleado_v_telefono,
            empleado_v_celular,
            empleado_v_email,
            empleado_v_ciudad,
            empleado_v_region,
            empleado_v_codpostal,
            empleado_n_activo)
        VALUES
            (#empleado_n_codigo#,
            #usuario_n_codigo#,
            #empresa_n_codigo#,
            #empleado_v_nombre#,
            #empleado_d_fechanac#,
            #empleado_v_apellido#,
            #empleado_n_dni#,
            #empleado_v_direccion#,
            #empleado_v_telefono#,
            #empleado_v_celular#,
            #empleado_v_email#,
            #empleado_v_ciudad#,
            #empleado_v_region#,
            #empleado_v_codpostal#,
            #empleado_n_activo#)
    </insert>


    <!-- MANTENIMIENTO DE USUARIOS -->

    <select id="getUsuarioPorUsername" resultClass="DTO_Usuario">
        SELECT
            us.usuario_v_username as username,
            us.usuario_v_contrasena as contrasena,
            us.empresa_n_codigo as empresa
        FROM
            T_SEG_USUARIO us
        WHERE
            us.usuario_v_username = #usuario_v_username#
        AND
            us.empresa_n_codigo = #empresa_n_codigo#
    </select>

    <select id="getUsuarios" resultClass="DTO_Usuario">
        SELECT
            us.usuario_n_codigo as codigo,
            us.usuario_v_username as username,
            us.usuario_v_contrasena as contrasena,
            us.empresa_n_codigo as empresa
        FROM
            T_SEG_USUARIO us
        WHERE
            us.empresa_n_codigo = #empresa_n_codigo#
        ORDER BY
            us.usuario_n_codigo
    </select>

    <insert id="insertUsuario" parameterClass="DTO_Usuario">
        <selectKey keyProperty="codigo" resultClass="int">
            SELECT seq_T_SEG_USUARIO.NEXTVAL FROM DUAL
        </selectKey>
        INSERT INTO T_SEG_USUARIO
            (usuario_n_codigo,usuario_v_username,usuario_v_contrasena,empresa_n_codigo)
        VALUES
            (#codigo#, #username#, #contrasena#, #empresa#)
    </insert>

    <update id="chgPass">
        UPDATE T_SEG_USUARIO
        SET
            usuario_v_contrasena = #usuario_v_contrasena#
        WHERE
            usuario_v_username = #usuario_v_username#
        AND
            empresa_n_codigo = #empresa_n_codigo#
    </update>

    <!-- MANTENIMIENTO DE EMPRESAS -->

    <select id="getEmpresaPorCodigo" resultClass="DTO_Empresa">
        SELECT
            emp.empresa_n_codigo as codigo,
            emp.empresa_v_nombre as nombre,
            emp.empresa_n_activo as estado,
            emp.empresa_n_razonsocial as ruc
        FROM
            T_EMP_EMPRESA emp
        WHERE
            emp.empresa_n_codigo = #empresa_n_codigo#
    </select>

    <select id="getEmpresas" resultClass="DTO_Empresa">
        SELECT
            emp.empresa_n_codigo as codigo,
            emp.empresa_v_razonsocial as razonsocial,
            emp.empresa_n_activo as estado,
            emp.empresa_n_ruc as ruc
        FROM
            T_EMP_EMPRESA emp
        WHERE
            emp.empresa_n_activo = 1
            <isNotNull prepend="AND" property="empresa_v_razonsocial">
               emp.empresa_v_razonsocial LIKE #empresa_v_razonsocial#
            </isNotNull>
            <isNotNull prepend="OR" property="empresa_n_ruc">
               emp.empresa_n_ruc LIKE #empresa_n_ruc#
            </isNotNull>
    </select>

    <insert id="insertEmpresa" parameterClass="DTO_Empresa">
        <selectKey keyProperty="codigo" resultClass="int">
            SELECT seq_T_EMP_EMPRESA.NEXTVAL FROM DUAL
        </selectKey>
        INSERT INTO T_EMP_EMPRESA
            (empresa_n_codigo,empresa_v_nombre,empresa_n_activo,empresa_n_razonsocial)
        VALUES
            (#codigo#,#razonsocial#,#estado#,#ruc#)
    </insert>
    
    <update id="updateEmpresa">
        UPDATE T_EMP_EMPRESA
        SET
            empresa_n_codigo = #empresa_n_codigo#,
            empresa_v_nombre = #empresa_v_nombre#,
            empresa_n_activo = #empresa_n_activo#,
            empresa_n_razonsocial = #empresa_n_razonsocial#
        WHERE
            empresa_n_codigo = #empresa_n_codigo#
    </update>

   <delete id="deleteEmpresa">
      DELETE FROM
         T_EMP_EMPRESA
      WHERE
         empresa_n_codigo = #value#
	</delete>
</sqlMap>
